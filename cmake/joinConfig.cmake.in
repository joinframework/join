@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

find_dependency(Threads)
find_dependency(OpenSSL)

set(join_KNOWN_COMPONENTS core crypto data fabric services)

if(NOT join_FIND_COMPONENTS)
    set(join_FIND_COMPONENTS ${join_KNOWN_COMPONENTS})
endif()

foreach(comp ${join_FIND_COMPONENTS})
    if(NOT comp IN_LIST join_KNOWN_COMPONENTS)
        set(join_FOUND FALSE)
        set(join_NOT_FOUND_MESSAGE "Unknown component: ${comp}. Available components: ${join_KNOWN_COMPONENTS}")
        return()
    endif()
endforeach()

if("data" IN_LIST join_FIND_COMPONENTS AND @JOIN_ENABLE_DATA@)
    find_dependency(ZLIB)
endif()

if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/joinTargets.cmake")
    include("${CMAKE_CURRENT_LIST_DIR}/joinTargets.cmake")

    if(TARGET join::join_core AND NOT TARGET join::core)
        add_library(join::core ALIAS join::join_core)
    endif()
    if(TARGET join::join_crypto AND NOT TARGET join::crypto)
        add_library(join::crypto ALIAS join::join_crypto)
    endif()
    if(TARGET join::join_data AND NOT TARGET join::data)
        add_library(join::data ALIAS join::join_data)
    endif()
    if(TARGET join::join_fabric AND NOT TARGET join::fabric)
        add_library(join::fabric ALIAS join::join_fabric)
    endif()
    if(TARGET join::join_services AND NOT TARGET join::services)
        add_library(join::services ALIAS join::join_services)
    endif()
else()
    set(join_FOUND FALSE)
    set(join_NOT_FOUND_MESSAGE "joinTargets.cmake not found")
    return()
endif()

set(_join_missing_components "")

foreach(comp ${join_FIND_COMPONENTS})
    string(TOUPPER ${comp} comp_upper)

    if(NOT TARGET join::${comp})
        if(comp STREQUAL "core")
            # Core should always exist
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        elseif(comp STREQUAL "crypto" AND NOT @JOIN_ENABLE_CRYPTO@)
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        elseif(comp STREQUAL "data" AND NOT @JOIN_ENABLE_DATA@)
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        elseif(comp STREQUAL "fabric" AND NOT @JOIN_ENABLE_FABRIC@)
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        elseif(comp STREQUAL "services" AND NOT @JOIN_ENABLE_SERVICES@)
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        else()
            list(APPEND _join_missing_components ${comp})
            set(join_${comp}_FOUND FALSE)
        endif()
    else()
        set(join_${comp}_FOUND TRUE)
    endif()
endforeach()

if(_join_missing_components)
    if(join_FIND_REQUIRED)
        set(join_FOUND FALSE)
        set(join_NOT_FOUND_MESSAGE "Could not find required components: ${_join_missing_components}. Check that they were enabled during build.")
        return()
    else()
        message(WARNING "Could not find optional components: ${_join_missing_components}")
    endif()
endif()

set(JOIN_LIBRARIES)
set(JOIN_INCLUDE_DIRS)

foreach(comp ${join_FIND_COMPONENTS})
    if(TARGET join::${comp})
        list(APPEND JOIN_LIBRARIES join::${comp})
        get_target_property(_inc join::${comp} INTERFACE_INCLUDE_DIRECTORIES)
        if(_inc)
            list(APPEND JOIN_INCLUDE_DIRS ${_inc})
        endif()
    endif()
endforeach()

if(JOIN_INCLUDE_DIRS)
    list(REMOVE_DUPLICATES JOIN_INCLUDE_DIRS)
endif()

check_required_components(join)
